<!-- Chart component container -->
<div id="stacked-area-chart"></div>

<!-- Chart data passed from Django -->
<script id="chartdata" type="application/json">
    {{ chartdata|safe }}
</script>

<!-- D3.js Script for chart rendering -->
<script>
    // Parse the chart data from Django template
    const chartData = JSON.parse(document.getElementById('chartdata').textContent);

    // Extract the data for easier reference
    const xData = chartData.x;
    const yData1 = chartData.y1;
    const yData2 = chartData.y2;

    // Create SVG dimensions
    const width = 800;
    const height = 400;
    const margin = { top: 20, right: 30, bottom: 30, left: 40 };

    // Create an SVG element to contain the chart
    const svg = d3.select("#stacked-area-chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    // X and Y scales
    const xScale = d3.scaleLinear()
        .domain(d3.extent(xData)) // Min and max of xData
        .range([0, width]);

    const yScale = d3.scaleLinear()
        .domain([0, d3.max([...yData1, ...yData2])]) // Combined max of y1 and y2
        .range([height, 0]);

    // Stack data: Combine y1 and y2
    const stack = d3.stack()
        .keys(["y1", "y2"])
        .value((d, key) => d[key]);

    const stackedData = stack([{ y1: yData1, y2: yData2 }]);

    // Area generator for the stacked chart
    const area = d3.area()
        .x((d, i) => xScale(xData[i]))
        .y0(d => yScale(d[0]))
        .y1(d => yScale(d[1]));

    // Add the stacked areas to the chart
    svg.selectAll("path")
        .data(stackedData)
        .join("path")
        .attr("d", area)
        .attr("fill", (d, i) => (i === 0 ? "steelblue" : "orange"))
        .attr("opacity", 0.8);

    // Add X axis
    svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(xScale));

    // Add Y axis
    svg.append("g")
        .call(d3.axisLeft(yScale));
</script>
